import SwiftUI

// MARK: - Pixel Icon Enum

/// Available pixel art icons for the app
enum PixelIcon: String, CaseIterable {
    case home
    case scroll      // For history/log
    case person
    case heart
    case heartFill
    case dumbbell
    case star
    case flame
    case sparkle
    case bolt
    case check
    case plus
    case minus
    case play
    case run
    case weight
    case clock
    case moon
    case sun
    case paw
    case leaf
    case cat
    case dog
    case dragon
    case trophy
    case shop
    case settings
    case arrow

    /// 12x12 pixel sprite data for each icon
    /// 0 = transparent, 1 = light, 2 = dark, 3 = darkest
    var spriteData: [[Int]] {
        switch self {
        case .home:
            return [
                [0,0,0,0,0,3,3,0,0,0,0,0],
                [0,0,0,0,3,2,2,3,0,0,0,0],
                [0,0,0,3,2,2,2,2,3,0,0,0],
                [0,0,3,2,2,2,2,2,2,3,0,0],
                [0,3,2,2,2,2,2,2,2,2,3,0],
                [3,2,2,2,2,2,2,2,2,2,2,3],
                [3,2,2,1,1,1,1,1,1,2,2,3],
                [3,2,2,1,1,1,1,1,1,2,2,3],
                [3,2,2,2,2,3,3,2,2,2,2,3],
                [3,2,2,2,2,3,3,2,2,2,2,3],
                [3,2,2,2,2,3,3,2,2,2,2,3],
                [3,3,3,3,3,3,3,3,3,3,3,3],
            ]
        case .scroll:
            return [
                [0,3,3,3,3,3,3,3,3,3,3,0],
                [3,1,1,1,1,1,1,1,1,1,1,3],
                [3,1,2,2,2,2,2,2,2,2,1,3],
                [3,1,1,1,1,1,1,1,1,1,1,3],
                [3,1,2,2,2,2,2,2,1,1,1,3],
                [3,1,1,1,1,1,1,1,1,1,1,3],
                [3,1,2,2,2,2,2,2,2,1,1,3],
                [3,1,1,1,1,1,1,1,1,1,1,3],
                [3,1,2,2,2,2,2,1,1,1,1,3],
                [3,1,1,1,1,1,1,1,1,1,1,3],
                [3,1,1,1,1,1,1,1,1,1,1,3],
                [0,3,3,3,3,3,3,3,3,3,3,0],
            ]
        case .person:
            return [
                [0,0,0,0,3,3,3,3,0,0,0,0],
                [0,0,0,3,2,2,2,2,3,0,0,0],
                [0,0,0,3,2,2,2,2,3,0,0,0],
                [0,0,0,0,3,3,3,3,0,0,0,0],
                [0,0,0,0,0,3,3,0,0,0,0,0],
                [0,0,3,3,3,3,3,3,3,3,0,0],
                [0,3,2,2,2,3,3,2,2,2,3,0],
                [0,3,2,2,2,3,3,2,2,2,3,0],
                [0,0,0,0,0,3,3,0,0,0,0,0],
                [0,0,0,0,3,2,2,3,0,0,0,0],
                [0,0,0,3,2,2,2,2,3,0,0,0],
                [0,0,0,3,3,0,0,3,3,0,0,0],
            ]
        case .heart:
            return [
                [0,0,0,0,0,0,0,0,0,0,0,0],
                [0,0,3,3,0,0,0,3,3,0,0,0],
                [0,3,2,2,3,0,3,2,2,3,0,0],
                [3,2,2,2,2,3,2,2,2,2,3,0],
                [3,2,2,2,2,2,2,2,2,2,3,0],
                [3,2,2,2,2,2,2,2,2,2,3,0],
                [0,3,2,2,2,2,2,2,2,3,0,0],
                [0,0,3,2,2,2,2,2,3,0,0,0],
                [0,0,0,3,2,2,2,3,0,0,0,0],
                [0,0,0,0,3,2,3,0,0,0,0,0],
                [0,0,0,0,0,3,0,0,0,0,0,0],
                [0,0,0,0,0,0,0,0,0,0,0,0],
            ]
        case .heartFill:
            return [
                [0,0,0,0,0,0,0,0,0,0,0,0],
                [0,0,3,3,0,0,0,3,3,0,0,0],
                [0,3,3,3,3,0,3,3,3,3,0,0],
                [3,3,3,3,3,3,3,3,3,3,3,0],
                [3,3,3,3,3,3,3,3,3,3,3,0],
                [3,3,3,3,3,3,3,3,3,3,3,0],
                [0,3,3,3,3,3,3,3,3,3,0,0],
                [0,0,3,3,3,3,3,3,3,0,0,0],
                [0,0,0,3,3,3,3,3,0,0,0,0],
                [0,0,0,0,3,3,3,0,0,0,0,0],
                [0,0,0,0,0,3,0,0,0,0,0,0],
                [0,0,0,0,0,0,0,0,0,0,0,0],
            ]
        case .dumbbell:
            return [
                [0,0,0,0,0,0,0,0,0,0,0,0],
                [0,3,3,0,0,0,0,0,0,3,3,0],
                [3,2,2,3,0,0,0,0,3,2,2,3],
                [3,2,2,3,0,0,0,0,3,2,2,3],
                [3,2,2,3,3,3,3,3,3,2,2,3],
                [3,2,2,2,2,2,2,2,2,2,2,3],
                [3,2,2,2,2,2,2,2,2,2,2,3],
                [3,2,2,3,3,3,3,3,3,2,2,3],
                [3,2,2,3,0,0,0,0,3,2,2,3],
                [3,2,2,3,0,0,0,0,3,2,2,3],
                [0,3,3,0,0,0,0,0,0,3,3,0],
                [0,0,0,0,0,0,0,0,0,0,0,0],
            ]
        case .star:
            return [
                [0,0,0,0,0,3,3,0,0,0,0,0],
                [0,0,0,0,0,3,3,0,0,0,0,0],
                [0,0,0,0,3,2,2,3,0,0,0,0],
                [3,3,3,3,3,2,2,3,3,3,3,3],
                [0,3,2,2,2,2,2,2,2,2,3,0],
                [0,0,3,2,2,2,2,2,2,3,0,0],
                [0,0,0,3,2,2,2,2,3,0,0,0],
                [0,0,3,2,2,2,2,2,2,3,0,0],
                [0,3,2,2,3,0,0,3,2,2,3,0],
                [3,2,2,3,0,0,0,0,3,2,2,3],
                [3,2,3,0,0,0,0,0,0,3,2,3],
                [3,3,0,0,0,0,0,0,0,0,3,3],
            ]
        case .flame:
            return [
                [0,0,0,0,0,3,0,0,0,0,0,0],
                [0,0,0,0,3,2,3,0,0,0,0,0],
                [0,0,0,3,2,2,2,3,0,3,0,0],
                [0,0,3,2,2,2,2,2,3,2,3,0],
                [0,0,3,2,2,1,2,2,2,2,3,0],
                [0,3,2,2,1,1,1,2,2,2,2,3],
                [0,3,2,2,1,1,1,2,2,2,2,3],
                [3,2,2,2,2,1,2,2,2,2,2,3],
                [3,2,2,2,2,2,2,2,2,2,3,0],
                [3,2,2,2,2,2,2,2,2,3,0,0],
                [0,3,2,2,2,2,2,2,3,0,0,0],
                [0,0,3,3,3,3,3,3,0,0,0,0],
            ]
        case .sparkle:
            return [
                [0,0,0,0,0,3,0,0,0,0,0,0],
                [0,0,0,0,0,3,0,0,0,0,0,0],
                [0,0,0,0,3,2,3,0,0,0,0,0],
                [0,0,0,0,0,3,0,0,0,0,0,0],
                [0,0,3,0,0,3,0,0,3,0,0,0],
                [3,3,2,3,3,2,3,3,2,3,3,0],
                [0,0,3,0,0,3,0,0,3,0,0,0],
                [0,0,0,0,0,3,0,0,0,0,0,0],
                [0,0,0,0,3,2,3,0,0,0,0,0],
                [0,0,0,0,0,3,0,0,0,0,0,0],
                [0,0,0,0,0,3,0,0,0,0,0,0],
                [0,0,0,0,0,0,0,0,0,0,0,0],
            ]
        case .bolt:
            return [
                [0,0,0,0,0,0,3,3,3,3,0,0],
                [0,0,0,0,0,3,2,2,2,3,0,0],
                [0,0,0,0,3,2,2,2,3,0,0,0],
                [0,0,0,3,2,2,2,3,0,0,0,0],
                [0,0,3,2,2,2,3,0,0,0,0,0],
                [0,3,2,2,2,2,2,2,3,0,0,0],
                [3,2,2,2,2,2,2,2,2,3,0,0],
                [0,0,0,0,3,2,2,2,3,0,0,0],
                [0,0,0,0,0,3,2,2,2,3,0,0],
                [0,0,0,0,0,0,3,2,2,2,3,0],
                [0,0,0,0,0,0,0,3,2,2,3,0],
                [0,0,0,0,0,0,0,0,3,3,0,0],
            ]
        case .check:
            return [
                [0,0,0,0,0,0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0,0,0,0,3,0],
                [0,0,0,0,0,0,0,0,0,3,2,3],
                [0,0,0,0,0,0,0,0,3,2,3,0],
                [0,0,0,0,0,0,0,3,2,3,0,0],
                [0,3,0,0,0,0,3,2,3,0,0,0],
                [0,3,2,3,0,3,2,3,0,0,0,0],
                [0,0,3,2,3,2,3,0,0,0,0,0],
                [0,0,0,3,2,3,0,0,0,0,0,0],
                [0,0,0,0,3,0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0,0,0,0,0,0],
            ]
        case .plus:
            return [
                [0,0,0,0,0,0,0,0,0,0,0,0],
                [0,0,0,0,3,3,3,3,0,0,0,0],
                [0,0,0,0,3,2,2,3,0,0,0,0],
                [0,0,0,0,3,2,2,3,0,0,0,0],
                [0,3,3,3,3,2,2,3,3,3,3,0],
                [0,3,2,2,2,2,2,2,2,2,3,0],
                [0,3,2,2,2,2,2,2,2,2,3,0],
                [0,3,3,3,3,2,2,3,3,3,3,0],
                [0,0,0,0,3,2,2,3,0,0,0,0],
                [0,0,0,0,3,2,2,3,0,0,0,0],
                [0,0,0,0,3,3,3,3,0,0,0,0],
                [0,0,0,0,0,0,0,0,0,0,0,0],
            ]
        case .minus:
            return [
                [0,0,0,0,0,0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0,0,0,0,0,0],
                [0,3,3,3,3,3,3,3,3,3,3,0],
                [0,3,2,2,2,2,2,2,2,2,3,0],
                [0,3,2,2,2,2,2,2,2,2,3,0],
                [0,3,3,3,3,3,3,3,3,3,3,0],
                [0,0,0,0,0,0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0,0,0,0,0,0],
            ]
        case .play:
            return [
                [0,0,0,0,0,0,0,0,0,0,0,0],
                [0,3,3,0,0,0,0,0,0,0,0,0],
                [0,3,2,3,3,0,0,0,0,0,0,0],
                [0,3,2,2,2,3,3,0,0,0,0,0],
                [0,3,2,2,2,2,2,3,3,0,0,0],
                [0,3,2,2,2,2,2,2,2,3,3,0],
                [0,3,2,2,2,2,2,2,2,3,3,0],
                [0,3,2,2,2,2,2,3,3,0,0,0],
                [0,3,2,2,2,3,3,0,0,0,0,0],
                [0,3,2,3,3,0,0,0,0,0,0,0],
                [0,3,3,0,0,0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0,0,0,0,0,0],
            ]
        case .run:
            return [
                [0,0,0,0,3,3,3,0,0,0,0,0],
                [0,0,0,3,2,2,2,3,0,0,0,0],
                [0,0,0,0,3,3,3,0,0,0,0,0],
                [0,0,0,0,0,3,0,0,0,0,0,0],
                [0,0,3,3,3,3,3,3,0,0,0,0],
                [0,3,2,0,0,3,0,0,3,0,0,0],
                [3,0,0,0,0,3,0,0,0,0,0,0],
                [0,0,0,0,3,0,3,0,0,0,0,0],
                [0,0,0,3,0,0,0,3,0,0,0,0],
                [0,0,3,0,0,0,0,0,3,0,0,0],
                [0,0,3,0,0,0,0,0,0,3,0,0],
                [0,3,3,0,0,0,0,0,0,3,3,0],
            ]
        case .weight:
            return [
                [0,0,3,3,3,3,3,3,3,3,0,0],
                [0,3,2,2,2,2,2,2,2,2,3,0],
                [3,2,2,2,2,2,2,2,2,2,2,3],
                [3,2,2,3,3,3,3,3,3,2,2,3],
                [3,2,3,1,1,1,1,1,1,3,2,3],
                [3,2,3,1,1,1,1,1,1,3,2,3],
                [3,2,3,1,1,1,1,1,1,3,2,3],
                [3,2,3,1,1,1,1,1,1,3,2,3],
                [3,2,2,3,3,3,3,3,3,2,2,3],
                [3,2,2,2,2,2,2,2,2,2,2,3],
                [0,3,2,2,2,2,2,2,2,2,3,0],
                [0,0,3,3,3,3,3,3,3,3,0,0],
            ]
        case .clock:
            return [
                [0,0,0,3,3,3,3,3,3,0,0,0],
                [0,0,3,2,2,2,2,2,2,3,0,0],
                [0,3,2,2,2,2,2,2,2,2,3,0],
                [3,2,2,2,2,3,2,2,2,2,2,3],
                [3,2,2,2,2,3,2,2,2,2,2,3],
                [3,2,2,2,2,3,2,2,2,2,2,3],
                [3,2,2,2,2,3,3,3,2,2,2,3],
                [3,2,2,2,2,2,2,2,2,2,2,3],
                [3,2,2,2,2,2,2,2,2,2,2,3],
                [0,3,2,2,2,2,2,2,2,2,3,0],
                [0,0,3,2,2,2,2,2,2,3,0,0],
                [0,0,0,3,3,3,3,3,3,0,0,0],
            ]
        case .moon:
            return [
                [0,0,0,0,0,3,3,3,3,0,0,0],
                [0,0,0,0,3,2,2,2,2,3,0,0],
                [0,0,0,3,2,2,2,2,2,2,3,0],
                [0,0,3,2,2,2,2,2,2,2,0,0],
                [0,0,3,2,2,2,2,2,2,0,0,0],
                [0,0,3,2,2,2,2,2,0,0,0,0],
                [0,0,3,2,2,2,2,2,0,0,0,0],
                [0,0,3,2,2,2,2,2,2,0,0,0],
                [0,0,3,2,2,2,2,2,2,2,0,0],
                [0,0,0,3,2,2,2,2,2,2,3,0],
                [0,0,0,0,3,2,2,2,2,3,0,0],
                [0,0,0,0,0,3,3,3,3,0,0,0],
            ]
        case .sun:
            return [
                [0,0,0,0,0,3,3,0,0,0,0,0],
                [0,3,0,0,0,3,3,0,0,0,3,0],
                [0,0,3,0,3,2,2,3,0,3,0,0],
                [0,0,0,3,2,2,2,2,3,0,0,0],
                [0,0,3,2,2,2,2,2,2,3,0,0],
                [3,3,2,2,2,2,2,2,2,2,3,3],
                [3,3,2,2,2,2,2,2,2,2,3,3],
                [0,0,3,2,2,2,2,2,2,3,0,0],
                [0,0,0,3,2,2,2,2,3,0,0,0],
                [0,0,3,0,3,2,2,3,0,3,0,0],
                [0,3,0,0,0,3,3,0,0,0,3,0],
                [0,0,0,0,0,3,3,0,0,0,0,0],
            ]
        case .paw:
            return [
                [0,0,3,3,0,0,0,0,3,3,0,0],
                [0,3,2,2,3,0,0,3,2,2,3,0],
                [0,3,2,2,3,0,0,3,2,2,3,0],
                [0,0,3,3,0,0,0,0,3,3,0,0],
                [3,3,0,0,0,0,0,0,0,0,3,3],
                [3,2,3,0,0,0,0,0,0,3,2,3],
                [0,3,0,0,3,3,3,3,0,0,3,0],
                [0,0,0,3,2,2,2,2,3,0,0,0],
                [0,0,3,2,2,2,2,2,2,3,0,0],
                [0,0,3,2,2,2,2,2,2,3,0,0],
                [0,0,0,3,2,2,2,2,3,0,0,0],
                [0,0,0,0,3,3,3,3,0,0,0,0],
            ]
        case .leaf:
            return [
                [0,0,0,0,0,0,0,0,0,3,3,0],
                [0,0,0,0,0,0,0,0,3,2,3,0],
                [0,0,0,3,3,3,3,3,2,3,0,0],
                [0,0,3,2,2,2,2,2,3,0,0,0],
                [0,3,2,2,2,2,2,3,0,0,0,0],
                [3,2,2,2,2,2,3,0,0,0,0,0],
                [3,2,2,2,2,3,0,0,0,0,0,0],
                [3,2,2,2,3,0,0,0,0,0,0,0],
                [0,3,2,3,0,0,0,0,0,0,0,0],
                [0,0,3,0,0,0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0,0,0,0,0,0],
            ]
        case .cat:
            return [
                [3,3,0,0,0,0,0,0,0,0,3,3],
                [3,2,3,0,0,0,0,0,0,3,2,3],
                [3,2,2,3,3,3,3,3,3,2,2,3],
                [0,3,2,2,2,2,2,2,2,2,3,0],
                [0,3,2,3,2,2,2,2,3,2,3,0],
                [0,3,2,2,2,2,2,2,2,2,3,0],
                [0,3,2,2,3,2,2,3,2,2,3,0],
                [0,3,2,2,2,3,3,2,2,2,3,0],
                [0,0,3,2,2,2,2,2,2,3,0,0],
                [0,0,0,3,3,3,3,3,3,0,0,0],
                [0,0,0,0,0,0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0,0,0,0,0,0],
            ]
        case .dog:
            return [
                [0,3,3,0,0,0,0,0,0,3,3,0],
                [3,2,2,3,0,0,0,0,3,2,2,3],
                [3,2,2,2,3,3,3,3,2,2,2,3],
                [0,3,2,2,2,2,2,2,2,2,3,0],
                [0,3,2,3,2,2,2,2,3,2,3,0],
                [0,3,2,2,2,2,2,2,2,2,3,0],
                [0,3,2,2,2,3,3,2,2,2,3,0],
                [0,0,3,2,2,2,2,2,2,3,0,0],
                [0,0,0,3,3,3,3,3,3,0,0,0],
                [0,0,0,3,2,0,0,2,3,0,0,0],
                [0,0,0,3,2,0,0,2,3,0,0,0],
                [0,0,0,0,0,0,0,0,0,0,0,0],
            ]
        case .dragon:
            return [
                [0,0,0,3,0,0,0,0,3,0,0,0],
                [0,0,3,2,3,0,0,3,2,3,0,0],
                [0,3,2,2,2,3,3,2,2,2,3,0],
                [3,2,2,2,2,2,2,2,2,2,2,3],
                [3,2,3,2,2,2,2,2,2,3,2,3],
                [3,2,2,2,2,2,2,2,2,2,2,3],
                [0,3,2,2,2,3,3,2,2,2,3,0],
                [0,0,3,2,2,2,2,2,2,3,0,0],
                [0,0,0,3,3,2,2,3,3,0,0,0],
                [0,0,0,0,3,2,2,3,0,0,0,0],
                [0,0,3,3,2,2,2,2,3,3,0,0],
                [0,3,3,0,0,0,0,0,0,3,3,0],
            ]
        case .trophy:
            return [
                [0,3,3,3,3,3,3,3,3,3,3,0],
                [0,3,2,2,2,2,2,2,2,2,3,0],
                [3,3,2,2,2,2,2,2,2,2,3,3],
                [3,2,3,2,2,2,2,2,2,3,2,3],
                [3,2,3,2,2,2,2,2,2,3,2,3],
                [0,3,0,3,2,2,2,2,3,0,3,0],
                [0,0,0,0,3,2,2,3,0,0,0,0],
                [0,0,0,0,3,2,2,3,0,0,0,0],
                [0,0,0,0,3,2,2,3,0,0,0,0],
                [0,0,0,3,2,2,2,2,3,0,0,0],
                [0,0,3,2,2,2,2,2,2,3,0,0],
                [0,0,3,3,3,3,3,3,3,3,0,0],
            ]
        case .shop:
            return [
                [0,0,0,0,3,3,3,3,0,0,0,0],
                [0,0,0,3,2,2,2,2,3,0,0,0],
                [0,0,3,2,2,2,2,2,2,3,0,0],
                [0,3,3,3,3,3,3,3,3,3,3,0],
                [0,3,2,2,2,2,2,2,2,2,3,0],
                [0,3,2,3,3,2,2,3,3,2,3,0],
                [0,3,2,3,3,2,2,3,3,2,3,0],
                [0,3,2,2,2,2,2,2,2,2,3,0],
                [0,3,2,2,2,2,2,2,2,2,3,0],
                [0,3,2,2,2,3,3,2,2,2,3,0],
                [0,3,2,2,2,3,3,2,2,2,3,0],
                [0,3,3,3,3,3,3,3,3,3,3,0],
            ]
        case .settings:
            return [
                [0,0,0,0,3,3,3,3,0,0,0,0],
                [0,0,0,3,2,2,2,2,3,0,0,0],
                [0,0,3,2,2,3,3,2,2,3,0,0],
                [0,3,2,2,3,1,1,3,2,2,3,0],
                [3,2,2,3,1,1,1,1,3,2,2,3],
                [3,2,2,3,1,1,1,1,3,2,2,3],
                [3,2,2,3,1,1,1,1,3,2,2,3],
                [3,2,2,3,1,1,1,1,3,2,2,3],
                [0,3,2,2,3,1,1,3,2,2,3,0],
                [0,0,3,2,2,3,3,2,2,3,0,0],
                [0,0,0,3,2,2,2,2,3,0,0,0],
                [0,0,0,0,3,3,3,3,0,0,0,0],
            ]
        case .arrow:
            return [
                [0,0,0,0,0,0,0,0,0,0,0,0],
                [0,0,0,0,0,0,3,0,0,0,0,0],
                [0,0,0,0,0,0,3,3,0,0,0,0],
                [0,0,0,0,0,0,3,2,3,0,0,0],
                [3,3,3,3,3,3,3,2,2,3,0,0],
                [3,2,2,2,2,2,2,2,2,2,3,0],
                [3,2,2,2,2,2,2,2,2,2,3,0],
                [3,3,3,3,3,3,3,2,2,3,0,0],
                [0,0,0,0,0,0,3,2,3,0,0,0],
                [0,0,0,0,0,0,3,3,0,0,0,0],
                [0,0,0,0,0,0,3,0,0,0,0,0],
                [0,0,0,0,0,0,0,0,0,0,0,0],
            ]
        }
    }
}

// MARK: - Pixel Icon View

/// Renders a pixel icon at the specified size
struct PixelIconView: View {
    let icon: PixelIcon
    let size: CGFloat
    let color: Color?

    init(icon: PixelIcon, size: CGFloat = 12, color: Color? = nil) {
        self.icon = icon
        self.size = size
        self.color = color
    }

    private var pixelSize: CGFloat {
        size / 12  // Icons are 12x12 base
    }

    var body: some View {
        Canvas { context, _ in
            let data = icon.spriteData
            for row in 0..<12 {
                for col in 0..<12 {
                    let value = data[row][col]
                    if value > 0 {
                        let pixelColor: Color = {
                            if let customColor = color {
                                // Use custom color with varying opacity for depth
                                switch value {
                                case 1: return customColor.opacity(0.5)
                                case 2: return customColor.opacity(0.8)
                                case 3: return customColor
                                default: return .clear
                                }
                            } else {
                                // Default bright colors for better visibility
                                switch value {
                                case 1: return PixelTheme.gbLightest
                                case 2: return PixelTheme.gbLight
                                case 3: return PixelTheme.gbLightest.opacity(0.7)
                                default: return .clear
                                }
                            }
                        }()
                        let rect = CGRect(
                            x: CGFloat(col) * pixelSize,
                            y: CGFloat(row) * pixelSize,
                            width: pixelSize,
                            height: pixelSize
                        )
                        context.fill(Path(rect), with: .color(pixelColor))
                    }
                }
            }
        }
        .frame(width: size, height: size)
    }
}

// MARK: - Preview

#Preview {
    ScrollView {
        LazyVGrid(columns: [
            GridItem(.flexible()),
            GridItem(.flexible()),
            GridItem(.flexible()),
            GridItem(.flexible())
        ], spacing: 20) {
            ForEach(PixelIcon.allCases, id: \.rawValue) { icon in
                VStack(spacing: 8) {
                    PixelIconView(icon: icon, size: 24)
                    Text(icon.rawValue)
                        .font(.system(size: 8))
                        .foregroundColor(PixelTheme.text)
                }
                .frame(width: 60, height: 60)
                .background(PixelTheme.cardBackground)
                .pixelOutline()
            }
        }
        .padding(20)
    }
    .background(PixelTheme.background)
}
